---
import WidgetLayout from "./WidgetLayout.astro";

const API_ENDPOINT = "https://api.freejk.com/shuju/jinjia/";

let priceText: string | null = null;
let internationalPrice: string | null = null;

try {
	const response = await fetch(API_ENDPOINT, {
		headers: {
			accept: "application/json",
		},
	});

	if (response.ok) {
		const payload = await response.json();
		const data = payload?.data ?? {};
		priceText = typeof data.price_text === "string" ? data.price_text : null;
		const intlRaw = data?.international_price;
		if (typeof intlRaw === "number") {
			internationalPrice = intlRaw.toString();
		} else if (typeof intlRaw === "string") {
			internationalPrice = intlRaw;
		}
	}
} catch (_error) {
	priceText = null;
	internationalPrice = null;
}

const internationalDisplay = internationalPrice ? `${internationalPrice} USD/oz` : null;
---
<WidgetLayout id="gold-price" name="今日金价">
	<dl class="text-sm leading-6 text-neutral-700 dark:text-neutral-300 min-h-[2.25rem] flex flex-col gap-2">
		<div class="flex items-center justify-between gap-4">
			<dt>国内金价</dt>
			<dd class="text-right">{priceText ?? "暂无数据"}</dd>
		</div>
		<div class="flex items-center justify-between gap-4">
			<dt>国际金价</dt>
			<dd class="text-right">{internationalDisplay ?? "暂无数据"}</dd>
		</div>
	</dl>
</WidgetLayout>
